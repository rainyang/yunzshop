{template 'common/header'}
<title>{$set['name']}</title>
<style type="text/css">
    body {margin:0px; background:#eee; font-family:'微软雅黑'; -moz-appearance:none;}
    .top {overflow: hidden; position:relative;}
    .top .bgimg {height:auto; position:relative;}
    .top .bgimg img { width:100%; position: relative;}
    .top .list {position:absolute;right:10px;top:10px;height:35px; width:auto; line-height:50px; font-size:16px; text-align:right; color:#efefef; margin-right:10px;}
    .top .topbar {height:220px; width:100%; position:absolute; bottom:-30px; left:0px; z-index:2;}
    .top .topbar .logo {height:80px; width:80px; padding:4px; border:1px solid #fff; border-radius:45px; margin:auto;}
    .top .topbar .logo img {height:70px; width:70px; padding:4px; border:1px solid #fff; border-radius:70px; margin:auto;}
    .top .topbar .shop_name {height:30px; width:auto; background:rgba(0,0,0,0.1); padding:0px 15px; margin:10px auto; font-size:16px; color:#fff; line-height:30px; text-align:center; display:table; border-radius:15px;}
    .top .topbar .menu {height:45px; width:100%; background:rgba(0,0,0,0.3);}
    .top .topbar .menu .nav {height:40px; width:25%; padding-top:5px; float:left; text-align:center; font-size:12px; color:#fff;}
    .top .topbar .menu .navon {height:37px; border-bottom:3px solid #dd2322;}
    .top .topbar .menu .nav i {font-size:18px;}
    .search { height: 30px; margin: 8px 0; background:#fff; color:#ccc; line-height: 30px; font-size:14px; border-radius: 15px; margin: 8px 46px 8px 5%; padding: 0 12px;  box-sizing:border-box; -moz-box-sizing:border-box; -webkit-box-sizing:border-box;}



    .title {height:40px; width:94%; background:#fff; padding:0px 3%; font-size:16px; color:#666; line-height:40px; font-size: 15px;}
    .goods {height:auto; min-height:100px; width:100%; background:#fff; overflow:hidden;float:left;padding-bottom: 5px;} 
    .goods .good {overflow:hidden; width:46%; padding:0px 2% 10px; float:left;}
    .goods .good .img {width:100%;overflow:hidden;}
    .goods .good .img img {width:100%;height:120px;}
    .goods .good .name {height:20px; width:100%; font-size:12px; line-height:20px; color:#666; overflow:hidden;}
    .goods .good .price {height:20px; width:100%; color:#f03; font-size:14px;}
    .goods .good .price span {color:#aaa; font-size:12px; text-decoration:line-through;}

    .copyright {height:40px; width:100%; text-align:center; line-height:30px; font-size:12px; color:#999; padding:10px 0 0; float: left;}
    /*.bottom_menu {height:50px; width:100%; background:#f90; position:fixed; bottom:0px; left:0px; z-index:1;}*/
 

    .banner {overflow:hidden;position:relative;height: 167px;}
     .banner  .main_image{width:100%;position:relative;top:0;left:0;}
  .banner .main_image ul{}
  .banner .main_image li{float:left;width: 100%;}
  .banner .main_image li img{display:block;width:100%; }
  .banner .main_image li a{display:block;width:100%;}

    div.flicking_con{position:absolute;bottom:10px;z-index:1;width:100%;height:12px;}
    div.flicking_con .inner { width:100%;height:9px;text-align:center;}
    div.flicking_con a{position:relative; width:10px;height:9px;background:url('../addons/sz_yi/template/mobile/default/static/images/dot.png') 0 0 no-repeat;display:inline-block;text-indent:-1000px}
    div.flicking_con a.on{background-position:0 -9px}
    #index_loading { width:94%;padding:10px;color:#666;text-align: center;float:left; font-size: 12px;}
    
    .class1 {background:#fff; border-top:1px solid #eee; border-bottom:1px solid #eee;overflow:hidden;margin-bottom:10px;}
.class1 .class2 {height:85px; width:25%; float:left;}
.class1 .class2:active {background:#f7f7f7;}
.class1 .class2 .class3 {height:70px; width:80px; margin:auto;}
.class1 .class2 .class3 .ico {height:40px; width:40px; margin:10px 15px 10px 15px; line-height:40px; text-align:center; color:#fff; font-size:18px;}
.class1 .class2 .class3 .ico img { width:50px;height:50px;}
.class1 .class2 .class3 .text {height:20px; width:80px; font-size:12px; color:#999; text-align:center; line-height:20px;overflow:hidden;}
.index-top{ overflow: hidden; background: #49f; position: relative;}
.indexlogo{ position: absolute; line-height: 46px; width: 20%; text-align: center; color: #fff; left: 0;}
.indexbell {
    position: absolute;
    right: 8px;
    top: 5px;
    color: #fff;
    display: inline-block;
    text-align: center;
    font-size: 21px;
    width: 35px;
    line-height: 35px;
    height: 35px;
    border-radius: 50%;
}
    .indexbell i{ position: relative;}
    .notice{ position: absolute; top: -3px; width: 12px; height: 12px; border-radius: 50%; background: #f00; right: 0;}
    .allgoods{ float: right; font-size: 12px; text-decoration: none; color: #999}
    .newbanner{ height: 150px; position: relative; }
    .bannerimg{ height: 150px; overflow: hidden; }
    .bannerimg img{ width: 100% }
    .bannerpoiner{ position: absolute; text-align: center; bottom: 2px; width: 100%;}
    .bannerpoiner li{ display: inline-block; }
    .bannerpoiner li a{ display: inline-block; width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,.5); margin: 0 1px;}
    .bannerpoiner li a.hover{ background: #3a7fff;}

    .swiper-container {
        width: 100%
    }
    .swiper-slide {
        text-align: center;
        font-size: 18px;
        background: #fff;

        /* Center slide text vertically */
        display: -webkit-box;
        display: -ms-flexbox;
        display: -webkit-flex;
        display: flex;
        -webkit-box-pack: center;
        -ms-flex-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
    }
</style>
<link rel="stylesheet" type="text/css" href="../addons/sz_yi/template/mobile/app/static/css/swiper.css">

<div id='list_contanier'></div>
<div id='container'></div>
 

<script id='tpl_index' type='text/html'>



    <div class="index-top">
        <!--<span class="indexlogo"><img src="../addons/sz_yi/template/pc/default/static/images/logo.png"></span>-->
        <div class='search'><i class="fa fa-search"></i> 在店铺内搜索</div>
        <a href="{php echo $this->createMobileUrl('member/messagelist')}" class="indexbell"><i class="fa fa-bell-o"><span class="notice" <%if is_read!='has'%> style="background:none" <%/if%>></span></i></a>
    </div>
    <%if advs.length>0%>
    <div class="banner">

        <%if advs.length>1%>
        <div class="flicking_con"><div class="inner">
            <%each advs as value index %>
            <a class="<%if index==0%>on<%/if%>" href="#@"><%index%></a>
            <%/each%>
            </div>
        </div>
        <%/if%>
        <div class="main_image" id='banner'>
            <ul>
                <%each advs as adv %>
                <li <%if adv.link%>onclick="location.href='<%adv.link%>'"<%/if%>> <img src="<%adv.thumb%>"></li>
                <%/each%>
            </ul>
        </div>
    </div>
    <%/if%>

   <!--  banner新begin  Swiper 
   <div class="swiper-container newbanner">
       <div class="swiper-wrapper">
           <div class="swiper-slide bannerimg"><img src="../addons/sz_yi/template/mobile/app/static/images/1.jpg"></div>
           <div class="swiper-slide bannerimg"><img src="../addons/sz_yi/template/mobile/app/static/images/2.jpg"></div>
           <div class="swiper-slide bannerimg"><img src="../addons/sz_yi/template/mobile/app/static/images/3.jpg"></div>
       </div>
       < Add Pagination 
       <div class="swiper-pagination bannerpoiner"></div>
   </div>

     banner新over-->
    
   
    <%if category.length>0%>
    <div class="title">推荐分类</div>
    <div class="class1">
        <%each category as value%>
        <a href="<%value.url%>">
            <div class="class2">
                <div class="class3">
                    <div class="ico ico1"><img src='<%value.thumb%>' /></div>
                    <div class="text"><%value.name%></div>
                </div>
            </div>
        </a>
       <%/each%>
    </div>
    <%/if%>
    
    <div class="title">推荐宝贝</div>
    <div class="goods">
        <div id='goods_container'></div>
    </div>

    
     <!--搜索-->
    <div class="search1"> 
                <div class="topbar1">
                    <div class='right'>                        
                        <button class="sub1">搜索</button>                        
                    </div>
                    <div class='left_wrap'> 
                        <div class='left'>
                            <div class="home1"><i class="fa fa-angle-left"></i></div>
                            <div class="search-inpu"><input type="text" id='keywords' class="input1" placeholder='输入商品关键词'/></div>
                        </div>
                    </div>
                </div>
                <div id='search_container' class='result1'>
        </div>
        
</script>

<script id='tpl_goods_list' type='text/html'>

    <%each goods as g%>
    <div class="good" data-goodsid='<%g.id%>'>
        <div class='img'><img src="<%g.thumb%>"></div>
        <div class="name"><%g.title%></div>
        <div class="price">￥<%g.marketprice%> <%if g.productprice>0 && g.marketprice!=g.productprice%><span>￥<%g.productprice%></span><%/if%></div>
    </div>
    <%/each%>

</script>
 <script id='tpl_search_list' type='text/html'>
     <ul>
     <%each list as value%>
        <li><i class="fa fa-angle-right"></i> <a href="{php echo $this->createMobileUrl('shop/detail')}&id=<%value.id%>"><%value.title%></a></li>
        <%/each%>
    </ul> 
</script>
<script language='javascript'>
    var update_version = 0;
    /*****************
     * IOS
     * @param callback
     * @returns {*}
     */

    function setupWebViewJavascriptBridge(callback) {
        if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
        if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
        window.WVJBCallbacks = [callback];
        var WVJBIframe = document.createElement('iframe');
        WVJBIframe.style.display = 'none';
        WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
        document.documentElement.appendChild(WVJBIframe);
        setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
    }

        setupWebViewJavascriptBridge(function(bridge) {
            //0-不更新;1-更新
            var resData = [update_version];
            bridge.callHandler("updateVersionHandler",resData,function(response)
            {
            });
        })


    var page = 1;
    var loaded = false;
    var stop = true;
    var scrolling = false;
    require(['core', 'tpl'], function (core, tpl) {
    
        core.json('shop/index', {}, function (json) {
            var result = json.result;

            $('#container').html(tpl('tpl_index', result));

          
            $('.nav').click(function () {
                $('.nav').removeClass('navon');
                $(this).addClass('navon');
                var op = $(this).data('op');
                if (op == 'all') {
                    location.href = core.getUrl('shop/list');
                } else if (op == 'discount') {
                    location.href = core.getUrl('shop/list', {isdiscount: 1});
                } else if (op == 'notice') {
                    location.href = core.getUrl('shop/notice');
                }
            });
        
            if (result.advs.length > 0) {
                
            //   $('.banner').height($('.main_image').find('img').height());
                
                require(['jquery','jquery.touchslider','swipe'], function ($) {
              
                    
                    new Swipe($('#banner')[0], {
			speed:300,
			auto:4000,
			callback: function(){
			  
                                 $(".flicking_con  .inner  a").removeClass("on").eq(this.index).addClass("on");
		}
	  }); 
       
                    
                
                })
            } 
            function getGoods(type) {

                core.json('shop/index', {'op': 'goods', page: page}, function (gjson) {
                    var result = gjson.result;
                    if (result.status == 0) {
                        core.message('服务器内部错误', core.getUrl('shop'), 'error');
                        return;
                    }
                    stop = true;
                    $('#index_loading').remove();
                    $('#goods_container').append(tpl('tpl_goods_list', result));
    $('.good img').each(function(){
                $(this).height($(this).width());
            })
                        $('.good').unbind('click').click(function(){
                            location.href = core.getUrl('shop/detail',{id:$(this).data('goodsid') });
                        })
                     
                    if (result.goods.length < result.pagesize && scrolling) {

                        $('#goods_container').append('<div id="index_loading">已经加载全部商品</div>');
                        loaded = true;
                        $(window).scroll = null;
                        return;
                    }
 
 

                    $(window).scroll(function () {

                        if (loaded) {
                            return;
                        }
                        totalheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop());
                        if ($(document).height() <= totalheight) {
                            if (stop == true) {
                                stop = false;scrolling=true; 
                                $('#goods_container').append('<div id="index_loading"><i class="fa fa-spinner fa-spin"></i> 正在加载更多商品</div>');
                                page++;
                                getGoods('display');
                            }
                        }
                    });
                });
            }

                $('.search').click(function(){

                          $(".search1").animate({bottom:"0px"},100);
                          $('#keywords').unbind('keyup').keyup(function(){
                                   var keywords = $.trim( $(this).val());
                                   if(keywords==''){
                                       $('#search_container').html("");         
                                       return;
                                   }
                                   core.json('shop/util',{op:'search',keywords:keywords }, function (json) {
                                        var result = json.result;
                                        if(result.list.length>0){
                                           $('#search_container').html(tpl('tpl_search_list',result));    
                                        }
                                        else{
                                           $('#search_container').html("");         
                                        }

                                     }, true);
                           });
                           $('.search1 .sub1').unbind('click').click(function(){
                                   var keywords = $.trim( $('#keywords').val());
                                   var url = core.getUrl('shop/list',{keywords:keywords});
                                   location.href=  url;
                            });
                           $('.search1 .home1').unbind('click').click(function(){
                                $(".search1").animate({bottom:"-100%"},100);
                           });
                       });

       
            getGoods();

        }, true);
    });
</script>
{php $show_footer=true;$footer_current ='first'}
{template 'common/footer'}
